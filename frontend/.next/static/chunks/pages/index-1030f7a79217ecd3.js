(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(3849)}])},3849:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return p}});var l=a(5893),n=a(7294),i=a(3299),r=a(7066),o=a(1093),s=a(1120),c=a.n(s),d=e=>{let{capsuleData:t,userChoices:a,completionStats:i,user:r,onCardGenerated:o}=e,[s,c]=(0,n.useState)(!1),[d,u]=(0,n.useState)(null),[h,m]=(0,n.useState)(!1),[p,b]=(0,n.useState)(0),f=(0,n.useRef)(null),x=(0,n.useRef)(null),g={cosmic:{background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",colors:["#533483","#7209b7","#a663cc","#4cc9f0"],particles:"⭐✨\uD83C\uDF1F\uD83D\uDCAB",font:"futuristic"},nature:{background:"linear-gradient(135deg, #2d5016 0%, #3e6b1f 50%, #4f8228 100%)",colors:["#60a531","#7cb342","#8bc34a","#9ccc65"],particles:"\uD83C\uDF43\uD83C\uDF3F\uD83C\uDF31\uD83C\uDF33",font:"organic"},retro:{background:"linear-gradient(135deg, #ff006e 0%, #fb5607 50%, #ffbe0b 100%)",colors:["#8338ec","#3a86ff","#06ffa5","#ffbe0b"],particles:"⚡\uD83D\uDD25\uD83D\uDCA5✨",font:"neon"},minimal:{background:"linear-gradient(135deg, #f8f9fa 0%, #e9ecef 50%, #dee2e6 100%)",colors:["#495057","#6c757d","#adb5bd","#ced4da"],particles:"●○◆◇",font:"clean"}},v=async()=>{c(!0);try{let e=await fetch("http://localhost:5000/api/generate-vibe-card-simple",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({capsuleData:t,userChoices:a,completionStats:i})}),l=await e.json();l.success&&(u(l.card),w(),null==o||o(l.card))}catch(e){console.error("Failed to generate Vibe Card:",e)}c(!1)},w=()=>{b(0),m(!0);let e=()=>{b(e=>(e+1)%450),x.current=requestAnimationFrame(e)};x.current=requestAnimationFrame(e),setTimeout(()=>{m(!1),x.current&&cancelAnimationFrame(x.current)},15e3)},y=()=>{if(!d||!f.current)return;let e=f.current,t=e.getContext("2d"),a=g[d.design.template];e.width=540,e.height=960,t.clearRect(0,0,e.width,e.height),j(t,a,p),D(t,a,d,p),k(t,a,d,p),C(t,a,d,p),S(t,a,p)},j=(e,t,a)=>{let l=e.createLinearGradient(0,0,540,960),n=t.colors,i=Math.floor(a/30%n.length),r=(i+1)%n.length;l.addColorStop(0,n[i]),l.addColorStop(.5,n[r]),l.addColorStop(1,n[(i+2)%n.length]),e.fillStyle=l,e.fillRect(0,0,540,960),N(e,t,a)},N=(e,t,a)=>{let l=t.particles.split("");e.font="30px Arial";for(let t=0;t<10;t++){let n=(54*t+2*a)%540,i=(96*t+25*Math.sin(.1*a+t))%960,r=.3+.2*Math.sin(.05*a+t);e.globalAlpha=r,e.fillText(l[t%l.length],n,i)}e.globalAlpha=1},D=(e,t,a,l)=>{let n=Math.min(l/60,1),i=150+(1-n)*100;e.globalAlpha=n,e.shadowColor=t.colors[0],e.shadowBlur=10,e.fillStyle="#ffffff",e.font="bold 36px Arial",e.textAlign="center",A(e,a.content.adventure.title,270,i,450,40),e.shadowBlur=5,e.font="24px Arial",e.fillStyle=t.colors[1];let r=a.content.adventure.outcome,o=Math.min(Math.floor(l/3),r.length);A(e,r.substring(0,o),270,i+80,450,30),e.globalAlpha=1,e.shadowBlur=0},k=(e,t,a,l)=>{let n=5*Math.sin(.2*l),i=1+.1*Math.sin(.3*l);e.save(),e.translate(270,600+n),e.scale(i,i),e.fillStyle="#ffffff",e.font="bold 48px Arial",e.textAlign="center",e.fillText("+".concat(a.content.achievement.points),0,0),e.font="24px Arial",e.fillText("VIBE POINTS",0,30),e.restore(),e.fillStyle=t.colors[2],e.font="bold 32px Arial",e.textAlign="center",e.fillText("\uD83D\uDD25 ".concat(a.content.achievement.streak," DAY STREAK"),270,700+n),a.content.achievement.badge&&(e.shadowColor=t.colors[0],e.shadowBlur=15,e.fillStyle="#FFD700",e.font="bold 28px Arial",e.fillText(a.content.achievement.badge,270,750),e.shadowBlur=0)},C=(e,t,a,l)=>{e.fillStyle="#ffffff",e.font="27px Arial",e.textAlign="center",e.fillText("@".concat(a.user.name),270,750),e.fillStyle=t.colors[1],e.font="21px Arial",e.fillText("".concat(a.user.totalPoints.toLocaleString()," Total Points"),270,790)},S=(e,t,a)=>{e.fillStyle="#ffffff",e.font="bold 36px Arial",e.textAlign="center",e.fillText("✨ SparkVibe",270,850);let l=["Daily Adventures Await","Spark Your Curiosity","Level Up Your Mindset","Discover. Grow. Shine."],n=Math.floor(a/90%l.length);e.fillStyle=t.colors[0],e.font="18px Arial",e.fillText(l[n],270,880)},A=(e,t,a,l,n,i)=>{let r=t.split(" "),o="",s=l;for(let t=0;t<r.length;t++){let l=o+r[t]+" ";e.measureText(l).width>n&&t>0?(e.fillText(o,a,s),o=r[t]+" ",s+=i):o=l}e.fillText(o,a,s)},E=async()=>{if(!f.current)return;y();let e=document.createElement("a");e.download="sparkvibe-card-".concat(Date.now(),".png"),e.href=f.current.toDataURL(),e.click()},T=async e=>{if(d)try{let t={title:"Check out my SparkVibe adventure!",text:d.sharing.captions[0],url:d.sharing.qrCode};if(navigator.share)await navigator.share(t);else{let a=encodeURIComponent(t.url),l=encodeURIComponent(t.text),n={twitter:"https://twitter.com/intent/tweet?text=".concat(l,"&url=").concat(a),facebook:"https://www.facebook.com/sharer/sharer.php?u=".concat(a),instagram:"#",tiktok:"#"};n[e]&&window.open(n[e],"_blank")}}catch(e){console.error("Share failed:",e)}};return(0,n.useEffect)(()=>{h&&d&&y()},[p,d,h]),(0,l.jsxs)("div",{className:"bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 rounded-3xl p-8 text-white",children:[(0,l.jsxs)("div",{className:"text-center mb-6",children:[(0,l.jsx)("h2",{className:"text-3xl font-bold mb-2 flex items-center justify-center gap-2",children:"✨ Create Your Vibe Card ✨"}),(0,l.jsx)("p",{className:"text-blue-200",children:"Turn your adventure into shareable magic!"})]}),d?(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"relative bg-black rounded-2xl overflow-hidden shadow-2xl mx-auto max-w-sm",children:[(0,l.jsx)("canvas",{ref:f,className:"w-full block",style:{aspectRatio:"9/16"}}),(0,l.jsxs)("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex gap-3",children:[(0,l.jsx)("button",{onClick:()=>{h?(m(!1),x.current&&cancelAnimationFrame(x.current)):w()},className:"bg-white/20 backdrop-blur-md hover:bg-white/30 p-3 rounded-full transition-all duration-300",children:h?"⏸️":"▶️"}),(0,l.jsx)("button",{onClick:()=>w(),className:"bg-white/20 backdrop-blur-md hover:bg-white/30 p-3 rounded-full transition-all duration-300",children:"\uD83D\uDD04"})]})]}),(0,l.jsxs)("div",{className:"bg-white/10 backdrop-blur-md rounded-2xl p-6",children:[(0,l.jsx)("h3",{className:"text-xl font-bold mb-3",children:"Your Adventure Summary"}),(0,l.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"font-semibold",children:"Adventure:"})," ",d.content.adventure.title]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"font-semibold",children:"Points Earned:"})," +",d.content.achievement.points]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"font-semibold",children:"Streak:"})," ",d.content.achievement.streak," days"]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"font-semibold",children:"Template:"})," ",d.design.template.charAt(0).toUpperCase()+d.design.template.slice(1)]})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,l.jsx)("button",{onClick:E,className:"bg-green-600 hover:bg-green-700 px-6 py-3 rounded-xl font-semibold flex items-center justify-center gap-2 transition-all duration-300",children:"\uD83D\uDCE5 Download"}),(0,l.jsx)("button",{onClick:()=>T("twitter"),className:"bg-blue-600 hover:bg-blue-700 px-6 py-3 rounded-xl font-semibold flex items-center justify-center gap-2 transition-all duration-300",children:"\uD83D\uDCE4 Share"})]}),(0,l.jsx)("div",{className:"grid grid-cols-4 gap-3",children:[{name:"TikTok",color:"bg-pink-600",emoji:"\uD83C\uDFB5"},{name:"Instagram",color:"bg-purple-600",emoji:"\uD83D\uDCF8"},{name:"Twitter",color:"bg-blue-500",emoji:"\uD83D\uDC26"},{name:"Snapchat",color:"bg-yellow-500",emoji:"\uD83D\uDC7B"}].map(e=>(0,l.jsxs)("button",{onClick:()=>T(e.name.toLowerCase()),className:"".concat(e.color," hover:opacity-80 p-3 rounded-xl text-center transition-all duration-300 transform hover:scale-105"),children:[(0,l.jsx)("div",{className:"text-2xl mb-1",children:e.emoji}),(0,l.jsx)("div",{className:"text-xs font-semibold",children:e.name})]},e.name))}),(0,l.jsxs)("div",{className:"text-center text-sm text-blue-200",children:[(0,l.jsx)("p",{className:"mb-2",children:"✨ Every share helps grow the SparkVibe community!"}),(0,l.jsx)("p",{className:"text-xs opacity-75",children:d.sharing.hashtags.join(" ")})]})]}):(0,l.jsx)("div",{className:"text-center",children:(0,l.jsx)("button",{onClick:v,disabled:s,className:"bg-gradient-to-r from-pink-500 to-violet-500 hover:from-pink-600 hover:to-violet-600 disabled:opacity-50 disabled:cursor-not-allowed px-8 py-4 rounded-2xl font-bold text-lg transition-all duration-300 transform hover:scale-105 shadow-lg",children:s?(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"Generating Magic..."]}):(0,l.jsx)("div",{className:"flex items-center gap-2",children:"✨ Generate Vibe Card ✨"})})})]})},u=a(3454);let h=u.env.NEXT_PUBLIC_VAPID_PUBLIC_KEY,m=u.env.NEXT_PUBLIC_API_URL||"https://sparkvibe-app-nyowz.ondigitalocean.app";function p(){var e,t,a;let{data:s}=(0,i.useSession)(),[u,p]=(0,n.useState)(null),[b,f]=(0,n.useState)(null),[x,g]=(0,n.useState)(""),[v,w]=(0,n.useState)(!1),[y,j]=(0,n.useState)(null),[N,D]=(0,n.useState)({}),[k,C]=(0,n.useState)({}),[S,A]=(0,n.useState)(!1);(0,n.useEffect)(()=>{"serviceWorker"in navigator&&"PushManager"in window&&E()},[]);let E=async()=>{try{let e=await navigator.serviceWorker.register("/sw.js");console.log("Service Worker registered:",e);let t=await e.pushManager.getSubscription();A(!!t)}catch(e){console.error("Service Worker registration failed:",e)}},T=async()=>{try{let e=await navigator.serviceWorker.ready,t=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:P(h)});await fetch("".concat(m,"/api/subscribe"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),A(!0),console.log("Subscribed to push notifications")}catch(e){console.error("Failed to subscribe to push notifications:",e)}},P=e=>{let t="=".repeat((4-e.length%4)%4),a=(e+t).replace(/-/g,"+").replace(/_/g,"/"),l=window.atob(a),n=new Uint8Array(l.length);for(let e=0;e<l.length;++e)n[e]=l.charCodeAt(e);return n},_=async()=>{try{let e=await r.Z.post("".concat(m,"/api/generate-capsule-simple"),{mood:x,interests:["general","adventure"]});p(e.data),j(e.data)}catch(e){console.error(e),alert("Capsule generation failed")}},V=async()=>{let e=document.getElementById("vibe-card");if(e){var t;let a=(await c()(e)).toDataURL("image/png");f({text:"I conquered ".concat(u.adventure.title,"! Vibe Points: ").concat(((null==s?void 0:null===(t=s.user)||void 0===t?void 0:t.vibePoints)||0)+10," #SparkVibe"),image:a})}},B=async(e,t)=>{try{var a,l;let n=await r.Z.post("".concat(m,"/api/update-points"),{username:(null==s?void 0:null===(a=s.user)||void 0===a?void 0:a.name)||"TestUser"});(null==s?void 0:s.user)&&(s.user.vibePoints=n.data.vibePoints,s.user.streak=n.data.streak);let i={adventure:e,adventureOutcome:(null===(l=u.adventure.options[t])||void 0===l?void 0:l.outcome)||"Amazing result!",brainBiteCorrect:!0,habitCompleted:!0};D(i),C({vibePointsEarned:15,timeSpent:300,mood:x}),setTimeout(()=>{w(!0)},2e3),V(),setTimeout(()=>p(null),5e3)}catch(e){console.error(e)}};return(0,n.useEffect)(()=>{x&&s&&_()},[x,s]),(0,l.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-500 to-purple-500 flex flex-col items-center p-4",children:[(0,l.jsx)("h1",{className:"text-4xl font-bold text-white mb-6",children:"SparkVibe"}),!s&&(0,l.jsx)("div",{className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-md",children:(0,l.jsx)("button",{onClick:()=>(0,i.signIn)("google"),className:"w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700",children:"Sign in with Google"})}),s&&(0,l.jsxs)(o.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-lg shadow-lg p-4 mb-4 w-full max-w-md",children:[(0,l.jsxs)("p",{className:"text-lg font-semibold",children:["Hey, ",null===(e=s.user)||void 0===e?void 0:e.name,"!"]}),(0,l.jsxs)("p",{children:["Vibe Points: ",null===(t=s.user)||void 0===t?void 0:t.vibePoints," | Streak: ",null===(a=s.user)||void 0===a?void 0:a.streak," days"]}),(0,l.jsxs)("div",{className:"mt-4 notification-manager",children:[!S&&(0,l.jsx)("button",{onClick:T,className:"bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg w-full",children:"\uD83D\uDD14 Enable Daily Reminders"}),S&&(0,l.jsx)("span",{className:"text-green-500 block text-center",children:"✅ Notifications Enabled"})]}),(0,l.jsx)("button",{onClick:()=>(0,i.signOut)(),className:"mt-2 text-blue-600 underline",children:"Sign Out"})]}),s&&!u&&!v&&(0,l.jsxs)(o.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-md",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"What's your vibe today?"}),(0,l.jsx)("div",{className:"space-y-4",children:["happy","chill","curious"].map(e=>(0,l.jsx)(o.E.button,{whileHover:{scale:1.05},onClick:()=>g(e),className:"w-full py-2 rounded text-white ".concat("happy"===e?"bg-yellow-400 hover:bg-yellow-500":"chill"===e?"bg-blue-400 hover:bg-blue-500":"bg-purple-400 hover:bg-purple-500"),children:"happy"===e?"\uD83D\uDE0A Happy":"chill"===e?"\uD83D\uDE0E Chill":"\uD83E\uDD14 Curious"},e))})]}),u&&!v&&(0,l.jsxs)(o.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-md",id:"vibe-card",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold mb-2",children:u.adventure.title}),(0,l.jsx)("p",{className:"mb-4",children:u.adventure.prompt}),(0,l.jsx)("div",{className:"space-y-2",children:u.adventure.options.map((e,t)=>(0,l.jsx)(o.E.button,{whileHover:{scale:1.05},onClick:()=>B("string"==typeof e?e:e.text,t),className:"w-full bg-purple-600 text-white py-2 rounded hover:bg-purple-700",children:"string"==typeof e?e:e.text},t))}),(0,l.jsx)("p",{className:"mt-4 text-green-600",children:u.moodBoost}),(0,l.jsx)("p",{className:"mt-2 font-semibold",children:u.brainBite.question}),(0,l.jsxs)("p",{className:"text-sm text-gray-600",children:["Answer: ",u.brainBite.answer]}),(0,l.jsx)("p",{className:"mt-2 text-blue-600",children:u.habitNudge.task})]}),v&&(0,l.jsxs)(o.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-lg",children:[(0,l.jsx)(d,{capsuleData:y,userChoices:N,completionStats:k,user:null==s?void 0:s.user,onCardGenerated:e=>{console.log("New Vibe Card generated:",e),p(null)}}),(0,l.jsx)("div",{className:"mt-6 flex gap-4 justify-center",children:(0,l.jsx)("button",{onClick:()=>{p(null),f(null),w(!1),g(""),j(null),D({}),C({})},className:"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 px-6 py-3 rounded-xl font-semibold text-white transition-all duration-300 transform hover:scale-105",children:"✨ New Adventure"})})]}),b&&!v&&(0,l.jsxs)(o.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mt-6 bg-white rounded-lg shadow-lg p-4 w-full max-w-md",children:[(0,l.jsx)("h3",{className:"text-xl font-bold mb-2",children:"Your Vibe Card"}),(0,l.jsx)("img",{src:b.image,alt:"Vibe Card",className:"w-full rounded"}),(0,l.jsx)("p",{className:"mt-2",children:b.text}),(0,l.jsx)(o.E.button,{whileHover:{scale:1.05},className:"mt-4 bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700",onClick:()=>{var e,t;return null===(e=(t=navigator).share)||void 0===e?void 0:e.call(t,{title:"SparkVibe",text:b.text,url:b.image})},children:"Share #SparkVibe"})]})]})}}},function(e){e.O(0,[443,541,888,774,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);